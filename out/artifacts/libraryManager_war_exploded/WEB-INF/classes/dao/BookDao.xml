<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace = "dao.BookDao">

    <resultMap id="bookDetail" type="po.Book" >
        <id property="bookId" column="book_id"/>
        <result property="isbn" column="book_isbn" />
        <result property="bookPlace" column="book_place"/>
        <result property="publishDate" column="book_date"/>
        <result property="bookName" column="book_name" />
        <result property="author" column="book_author" />
        <result property="publisher" column="book_publisher" />
        <result property="bookPage" column="book_page"/>
        <result property="price" column="book_price"/>
    </resultMap>

    <resultMap id="bookDetailAndCollection" type="Book" >
        <id property="bookId" column="book_id"/>
        <result property="isbn" column="book_isbn" />
        <result property="bookPlace" column="book_place"/>
        <result property="publishDate" column="book_date"/>
        <result property="bookName" column="book_name" />
        <result property="author" column="book_author" />
        <result property="publisher" column="book_publisher" />
        <result property="bookPage" column="book_page"/>
        <result property="price" column="book_price"/>
        <association property="libraryCollection" column="book_id" javaType="LibraryCollection"
                     select="dao.CollectionDao.findCollectionByBookId" />
    </resultMap>

    <select id="findBookById" parameterType="String" resultMap="bookDetail">
        select *
        from book
        where book_id = #{bookId}
    </select>

    <select id="findBookByPageNum" parameterType="po.Page" resultMap="bookDetail">
        select *
        from book
        limit #{startRecord}, #{endRecord}
    </select>

    <insert id="entryBook" parameterType="Book" >
        insert into book(book_isbn, book_name,book_author,book_place,book_date,book_publisher,book_page,
        book_price)
        values (#{isbn}, #{bookName},#{author},#{bookPlace},#{publishDate},
        #{publisher},#{bookPage},#{price})
    </insert>

    <select id="findBookByfield" resultMap="bookDetail" >
        select *
        from book
        where ${arg0} like concat('%', #{arg1}, '%')
    </select>

    <update id="updateBookInfo" parameterType="Book" >
        update book
        set book_name = #{bookName}, book_author = #{author}, book_place = #{bookPlace},
            book_date = #{publishDate}, book_publisher = #{publisher}, book_page = #{bookPage},
            book_price = #{price}
        where book_id = #{bookId}
    </update>

    <delete id="deleteBook" parameterType="String">
        delete
        from book
        where book_id = #{bookId}
    </delete>

    <select id="findBookDetail" parameterType="String" resultMap="bookDetailAndCollection">
        select *
        from book
        where book_id = #{bookId}
    </select>

</mapper>